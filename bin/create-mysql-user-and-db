#!/usr/bin/env bash
echo -n "Please enter username: "
read username
echo -n "Please enter root user MySQL password: "
read -s rootpasswd
echo ""

MAINDB=${username//[^a-zA-Z0-9]/_}
PASSWDDB="$(openssl rand -base64 12)"


mysql -uroot -p${rootpasswd} -e "CREATE DATABASE ${username} /*\!40100 DEFAULT CHARACTER SET utf8 */;"
mysql -uroot -p${rootpasswd} -e "CREATE USER ${username}@localhost IDENTIFIED BY '${PASSWDDB}';"
mysql -uroot -p${rootpasswd} -e "GRANT ALL PRIVILEGES ON ${username}.* TO '${username}'@'localhost';"
mysql -uroot -p${rootpasswd} -e "FLUSH PRIVILEGES;"

DATA_DIR="~/.sau/data/mysql"

if [[ ! -d ${DATA_DIR} ]]; then
    mkdir -p ${DATA_DIR}
fi;


exec 1> "${DATA_DIR}/${username}.txt"

echo "Host:     localhost"
echo "Database: ${MAINDB}"
echo "User:     ${MAINDB}"
echo "Password: ${PASSWDDB}"
